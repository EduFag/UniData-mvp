{% extends 'base.html' %}

{% block title %}Histórico - UniData{% endblock %}

{% block navbar %}
<div class="mobile-navbar d-flex justify-content-between align-items-center">
    <div>
        <h5 class="m-0 fw-bold"><i class="bi bi-file-medical-fill"></i> Histórico Clínico</h5>
        <small style="opacity: 0.9; font-size: 0.8rem;">Prontuários</small>
    </div>
</div>
{% endblock %}

{% block content %}

<style>
    /* Estilo Timeline */
    .timeline-item {
        border-left: 2px solid #e2e8f0;
        padding-left: 20px;
        position: relative;
        margin-bottom: 25px;
    }

    /* Bolinha da timeline */
    .timeline-dot {
        width: 12px;
        height: 12px;
        background: #667eea;
        border-radius: 50%;
        position: absolute;
        left: -7px;
        top: 5px;
        box-shadow: 0 0 0 4px #eef2ff;
    }

    .record-card {
        background: white;
        border-radius: 15px;
        padding: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        border: 1px solid #f1f5f9;
        transition: transform 0.2s;
    }

    .record-card:active {
        transform: scale(0.98);
    }

    .doctor-badge {
        background: #f8fafc;
        color: #475569;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 0.75rem;
        font-family: monospace;
        display: inline-block;
        margin-top: 8px;
    }

    .date-label {
        font-size: 0.8rem;
        font-weight: 700;
        color: #64748b;
        margin-bottom: 5px;
        display: block;
    }
    
    .cid-text {
        color: #1e293b;
        font-size: 0.95rem;
        line-height: 1.4;
    }
</style>

<div class="mt-2 mb-4">
    {% if erro_api %}
        <div class="alert alert-warning shadow-sm border-0">
            <i class="bi bi-exclamation-triangle-fill me-2"></i> {{ erro_api }}
        </div>
    {% endif %}

    {% if historico %}
        <div style="padding-left: 10px;">
            {% for item in historico %}
            <div class="timeline-item">
                <div class="timeline-dot"></div>
                
                <span class="date-label">
                    <i class="bi bi-calendar-event me-1"></i> {{ item.data_registro }}
                </span>

                <div class="record-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <h6 class="fw-bold mb-2 text-primary">Registro #{{ item.id }}</h6>
                        <i class="bi bi-clipboard-pulse"></i>
                    </div>
                    
                    <p class="mb-0 cid-text">
                        {{ item.cid }}
                    </p>

                    <div class="doctor-badge">
                        <i class="bi bi-person-fill-add me-1"></i> 
                        Dr(a): {{ item.profissional|truncatechars:15 }}
                    </div>

                    <button class="btn btn-sm text-dark fw-bold rounded-pill px-3" onclick="navigator.clipboard.writeText('{{ item.profissional }}'); alert('Endereço copiado para a área de transferência!');">
                        <i class="bi bi-copy"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="text-center mt-4 mb-5 text-muted small">
            <i class="bi bi-check-all"></i> Fim do histórico
        </div>

    {% else %}
        <div class="text-center mt-5 pt-4">
            <div style="width: 80px; height: 80px; background: #e0e7ff; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 20px;">
                <i class="bi bi-journal-medical" style="font-size: 2rem; color: #667eea;"></i>
            </div>
            <h5 class="fw-bold text-dark">Nenhum registro</h5>
            <p class="text-muted small px-4">
                Você ainda não possui prontuários registrados na blockchain. Quando um médico criar um registro, ele aparecerá aqui.
            </p>
        </div>
    {% endif %}
</div>

{% endblock %}