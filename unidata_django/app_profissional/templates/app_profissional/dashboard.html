{% extends 'base_dashboard.html' %}

{% block title %}Dashboard - Unidata{% endblock %}

{% block content %}

    <div class="header">
        <div>
            <h1>Olá, {{ profissional.user.first_name }}</h1>
            <span style="color: #64748b;">CRM: {{ profissional.crm }}</span>
        </div>
    </div>

    <div class="card" style="background: #eff6ff; border: 1px solid #dbeafe;">
        <h3 style="margin-top: 0; color: #1e3a8a;">Iniciar Novo Atendimento</h3>
        <p style="font-size: 14px; color: #64748b;">Digite o CPF do paciente para buscar no sistema e abrir o prontuário.</p>
        
        <form action="{% url 'buscar_paciente' %}" method="POST" style="display: flex; gap: 10px;">
            {% csrf_token %}
            <input type="text" name="cpf" placeholder="CPF do paciente (apenas números)" required>
            <button type="submit" class="btn btn-blue">Buscar e Abrir</button>
        </form>
    </div>

    <div class="card">
        <h2>Meus Pacientes Recentes</h2>
        
        {% if meus_pacientes %}
            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                <thead>
                    <tr style="text-align: left; color: #64748b; border-bottom: 2px solid #f1f5f9;">
                        <th style="padding: 10px;">Nome</th>
                        <th style="padding: 10px;">CPF</th>
                        <th style="padding: 10px;">Último Acesso</th>
                        <th style="padding: 10px;">Ação</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in meus_pacientes %}
                    <tr style="border-bottom: 1px solid #f1f5f9;">
                        <td style="padding: 15px 10px;"><strong>{{ item.paciente.user.get_full_name }}</strong></td>
                        <td style="padding: 15px 10px;">{{ item.paciente.cpf }}</td>
                        <td style="padding: 15px 10px; color: #64748b;">{{ item.data_ultimo_acesso|date:"d/m/Y H:i" }}</td>
                        <td style="padding: 15px 10px;">
                            <a href="{% url 'ver_prontuario' item.paciente.id %}" class="btn btn-green" style="padding: 6px 12px; font-size: 13px;">
                                Acessar Prontuário
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p style="text-align: center; padding: 20px; color: #94a3b8;">
                Nenhum paciente vinculado ainda. Use a busca acima para começar.
            </p>
        {% endif %}
    </div>

{% endblock %}
